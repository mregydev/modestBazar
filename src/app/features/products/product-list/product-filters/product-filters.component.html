<div class="filters-sidebar">
  <div class="filters-header">
    <h2>Filter</h2>
    <button type="button" class="clear-all-btn" (click)="clearAllFilters()">Clear all</button>
  </div>

  <form [formGroup]="filterForm" class="filters-form">
    <!-- Category Filter -->
    @if (isGroupEnabled('category')) {
    <div class="filter-section">
      <button
        type="button"
        class="filter-section-header"
        (click)="toggleSection('category')"
      >
        <span>Category</span>
        <span class="expand-icon">{{ isSectionExpanded('category') ? '−' : '+' }}</span>
      </button>
      @if (isSectionExpanded('category')) {
        <div class="filter-options">
          @for (category of availableFilters.categories; track category) {
            <label class="filter-checkbox">
              <input
                type="checkbox"
                [checked]="isChecked('categories', category)"
                (change)="onCheckboxChange('categories', category, $event)"
              />
              <span>{{ getCategoryLabel(category) }}</span>
            </label>
          }
        </div>
      }
    </div>
    }

    <!-- Size Filter -->
    @if (isGroupEnabled('size')) {
    <div class="filter-section">
      <button
        type="button"
        class="filter-section-header"
        (click)="toggleSection('size')"
      >
        <span>Size</span>
        <span class="expand-icon">{{ isSectionExpanded('size') ? '−' : '+' }}</span>
      </button>
      @if (isSectionExpanded('size')) {
        <div class="filter-options size-grid">
          @for (size of availableFilters.sizes; track size) {
            <label class="filter-checkbox size-checkbox">
              <input
                type="checkbox"
                [checked]="isChecked('sizes', size)"
                (change)="onCheckboxChange('sizes', size, $event)"
              />
              <span>{{ size }}</span>
            </label>
          }
        </div>
      }
    </div>
    }

    <!-- Color Filter -->
    @if (isGroupEnabled('color')) {
    <div class="filter-section">
      <button
        type="button"
        class="filter-section-header"
        (click)="toggleSection('color')"
      >
        <span>Color</span>
        <span class="expand-icon">{{ isSectionExpanded('color') ? '−' : '+' }}</span>
      </button>
      @if (isSectionExpanded('color')) {
        <div class="filter-options color-grid">
          @for (color of availableFilters.colors; track color) {
            <label class="color-swatch">
              <input
                type="checkbox"
                [checked]="isChecked('colors', color)"
                (change)="onCheckboxChange('colors', color, $event)"
              />
              <span
                class="color-circle"
                [style.background-color]="getColorValue(color)"
                [title]="color.charAt(0).toUpperCase() + color.slice(1)"
              ></span>
            </label>
          }
        </div>
      }
    </div>
    }

    <!-- Price Filter -->
    @if (isGroupEnabled('price')) {
    <div class="filter-section">
      <button
        type="button"
        class="filter-section-header"
        (click)="toggleSection('price')"
      >
        <span>Price</span>
        <span class="expand-icon">{{ isSectionExpanded('price') ? '−' : '+' }}</span>
      </button>
      @if (isSectionExpanded('price')) {
        <div class="filter-options price-range">
          <div class="price-inputs">
            <input
              type="number"
              formControlName="minPrice"
              placeholder="Min"
              [min]="availableFilters.minPrice"
              [max]="availableFilters.maxPrice"
            />
            <span>to</span>
            <input
              type="number"
              formControlName="maxPrice"
              placeholder="Max"
              [min]="availableFilters.minPrice"
              [max]="availableFilters.maxPrice"
            />
          </div>
          <p class="price-range-hint">
            Range: {{ availableFilters.minPrice }} - {{ availableFilters.maxPrice }} EGP
          </p>
        </div>
      }
    </div>
    }

    <!-- Pattern Type Filter -->
    @if (isGroupEnabled('patternType')) {
    <div class="filter-section">
      <button
        type="button"
        class="filter-section-header"
        (click)="toggleSection('patternType')"
      >
        <span>Pattern Type</span>
        <span class="expand-icon">{{ isSectionExpanded('patternType') ? '−' : '+' }}</span>
      </button>
      @if (isSectionExpanded('patternType')) {
        <div class="filter-options">
          @for (pattern of availableFilters.patternTypes; track pattern) {
            <label class="filter-checkbox">
              <input
                type="checkbox"
                [checked]="isChecked('patternTypes', pattern)"
                (change)="onCheckboxChange('patternTypes', pattern, $event)"
              />
              <span>{{ pattern }}</span>
            </label>
          }
        </div>
      }
    </div>
    }

    <!-- Material Filter -->
    @if (isGroupEnabled('material')) {
    <div class="filter-section">
      <button
        type="button"
        class="filter-section-header"
        (click)="toggleSection('material')"
      >
        <span>Material</span>
        <span class="expand-icon">{{ isSectionExpanded('material') ? '−' : '+' }}</span>
      </button>
      @if (isSectionExpanded('material')) {
        <div class="filter-options">
          @for (material of availableFilters.materials; track material) {
            <label class="filter-checkbox">
              <input
                type="checkbox"
                [checked]="isChecked('materials', material)"
                (change)="onCheckboxChange('materials', material, $event)"
              />
              <span>{{ material }}</span>
            </label>
          }
        </div>
      }
    </div>
    }

    <!-- Occasion Filter -->
    @if (isGroupEnabled('occasion')) {
    <div class="filter-section">
      <button
        type="button"
        class="filter-section-header"
        (click)="toggleSection('occasion')"
      >
        <span>Occasion</span>
        <span class="expand-icon">{{ isSectionExpanded('occasion') ? '−' : '+' }}</span>
      </button>
      @if (isSectionExpanded('occasion')) {
        <div class="filter-options">
          @for (occasion of availableFilters.occasions; track occasion) {
            <label class="filter-checkbox">
              <input
                type="checkbox"
                [checked]="isChecked('occasions', occasion)"
                (change)="onCheckboxChange('occasions', occasion, $event)"
              />
              <span>{{ occasion }}</span>
            </label>
          }
        </div>
      }
    </div>
    }

    <!-- Brand Filter -->
    @if (isGroupEnabled('brand')) {
    <div class="filter-section">
      <button
        type="button"
        class="filter-section-header"
        (click)="toggleSection('brand')"
      >
        <span>Brand</span>
        <span class="expand-icon">{{ isSectionExpanded('brand') ? '−' : '+' }}</span>
      </button>
      @if (isSectionExpanded('brand')) {
        <div class="filter-options">
          @for (brand of availableFilters.brands; track brand) {
            <label class="filter-checkbox">
              <input
                type="checkbox"
                [checked]="isChecked('brands', brand)"
                (change)="onCheckboxChange('brands', brand, $event)"
              />
              <span>{{ brand }}</span>
            </label>
          }
        </div>
      }
    </div>
    }

    <!-- Modesty Attributes Filter -->
    @if (isGroupEnabled('modesty')) {
    <div class="filter-section">
      <button
        type="button"
        class="filter-section-header"
        (click)="toggleSection('modesty')"
      >
        <span>Modesty Attributes</span>
        <span class="expand-icon">{{ isSectionExpanded('modesty') ? '−' : '+' }}</span>
      </button>
      @if (isSectionExpanded('modesty')) {
        <div class="filter-options">
          <!-- Hijab Friendly -->
          @if (availableFilters.hijabFriendly.length > 0) {
            <div class="modesty-subsection">
              <strong>Hijab Friendly</strong>
              @for (value of availableFilters.hijabFriendly; track value) {
                <label class="filter-checkbox">
                  <input
                    type="checkbox"
                    [checked]="isChecked('hijabFriendly', value)"
                    (change)="onCheckboxChange('hijabFriendly', value, $event)"
                  />
                  <span>{{ value === 'yes' ? 'Yes' : value === 'maybe' ? 'Maybe' : 'No' }}</span>
                </label>
              }
            </div>
          }

          <!-- Sleeve Length -->
          @if (availableFilters.sleeveLengths.length > 0) {
            <div class="modesty-subsection">
              <strong>Sleeve Length</strong>
              @for (value of availableFilters.sleeveLengths; track value) {
                <label class="filter-checkbox">
                  <input
                    type="checkbox"
                    [checked]="isChecked('sleeveLengths', value)"
                    (change)="onCheckboxChange('sleeveLengths', value, $event)"
                  />
                  <span>{{ getSleeveLengthLabel(value) }}</span>
                </label>
              }
            </div>
          }

          <!-- Neckline Coverage -->
          @if (availableFilters.necklineCoverage.length > 0) {
            <div class="modesty-subsection">
              <strong>Neckline Coverage</strong>
              @for (value of availableFilters.necklineCoverage; track value) {
                <label class="filter-checkbox">
                  <input
                    type="checkbox"
                    [checked]="isChecked('necklineCoverage', value)"
                    (change)="onCheckboxChange('necklineCoverage', value, $event)"
                  />
                  <span>{{ value.charAt(0).toUpperCase() + value.slice(1) }}</span>
                </label>
              }
            </div>
          }

          <!-- Length Category -->
          @if (availableFilters.lengthCategories.length > 0) {
            <div class="modesty-subsection">
              <strong>Length Category</strong>
              @for (value of availableFilters.lengthCategories; track value) {
                <label class="filter-checkbox">
                  <input
                    type="checkbox"
                    [checked]="isChecked('lengthCategories', value)"
                    (change)="onCheckboxChange('lengthCategories', value, $event)"
                  />
                  <span>{{ value.charAt(0).toUpperCase() + value.slice(1) }}</span>
                </label>
              }
            </div>
          }

          <!-- Fit -->
          @if (availableFilters.fits.length > 0) {
            <div class="modesty-subsection">
              <strong>Fit</strong>
              @for (value of availableFilters.fits; track value) {
                <label class="filter-checkbox">
                  <input
                    type="checkbox"
                    [checked]="isChecked('fits', value)"
                    (change)="onCheckboxChange('fits', value, $event)"
                  />
                  <span>{{ value.charAt(0).toUpperCase() + value.slice(1) }}</span>
                </label>
              }
            </div>
          }

          <!-- Opacity -->
          @if (availableFilters.opacity.length > 0) {
            <div class="modesty-subsection">
              <strong>Opacity</strong>
              @for (value of availableFilters.opacity; track value) {
                <label class="filter-checkbox">
                  <input
                    type="checkbox"
                    [checked]="isChecked('opacity', value)"
                    (change)="onCheckboxChange('opacity', value, $event)"
                  />
                  <span>{{ value === 'opaque' ? 'Opaque' : 'Semi-sheer' }}</span>
                </label>
              }
            </div>
          }

          <!-- Slit Coverage -->
          @if (availableFilters.slitCoverage.length > 0) {
            <div class="modesty-subsection">
              <strong>Slit Coverage</strong>
              @for (value of availableFilters.slitCoverage; track value) {
                <label class="filter-checkbox">
                  <input
                    type="checkbox"
                    [checked]="isChecked('slitCoverage', value)"
                    (change)="onCheckboxChange('slitCoverage', value, $event)"
                  />
                  <span>{{ getSlitCoverageLabel(value) }}</span>
                </label>
              }
            </div>
          }
        </div>
      }
    </div>
    }
  </form>
</div>
