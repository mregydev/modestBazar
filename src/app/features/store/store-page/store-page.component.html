@if (store()) {
  <div class="store-page">
    <!-- LinkedIn-style Store Header -->
    <section class="store-header">
      <div class="store-banner">
        <img
          [src]="store()!.bannerImageUrl"
          [alt]="store()!.name + ' banner'"
          class="store-banner__image"
        />
        <!-- Logo positioned over banner bottom -->

      </div>
      <div class="store-logo-wrapper">
        <img
          [src]="store()!.logoImageUrl"
          [alt]="store()!.name + ' logo'"
          class="store-logo"
        />
      </div>
      <!-- Store Owner Edit Controls -->
        @if (isOwnerView()) {
          <div class="store-edit-controls">
            <button type="button" class="edit-btn" (click)="editBanner()">{{ translate('storePage.edit.banner') }}</button>
            <button type="button" class="edit-btn" (click)="editLogo()">{{ translate('storePage.edit.logo') }}</button>
          </div>
        }
    </section>

    <!-- Header content outside store-header -->
    <div class="store-header__content">
      <div class="store-info">
        <h1>{{ store()!.name }}</h1>
        @if (store()!.description) {
          <p class="store-description">{{ store()!.description }}</p>
        }
      </div>
    </div>

    <!-- Store Products Section with Filters -->
    <div class="store-page-body">
      <aside class="filters-column">
        @if (isMobile()) {
          <button type="button" class="filters-toggle-btn-mobile" (click)="toggleFilters()">
            <span>{{ isFiltersOpen() ? translate('storePage.filters.hide') : translate('storePage.filters.show') }}</span>
            <svg
              [class.rotated]="isFiltersOpen()"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M6 9l6 6 6-6"/>
            </svg>
          </button>
          <div class="filters-panel" [class.collapsed]="!isFiltersOpen()">
            <app-product-filters
              [availableFilters]="availableFilters()"
              [currentFilters]="currentFilters()"
              [enabledGroups]="store()!.visibleFilters"
              (filtersChange)="onFiltersChange($event)"
            ></app-product-filters>
          </div>
        } @else {
          <app-product-filters
            [availableFilters]="availableFilters()"
            [currentFilters]="currentFilters()"
            [enabledGroups]="store()!.visibleFilters"
            (filtersChange)="onFiltersChange($event)"
          ></app-product-filters>
        }
      </aside>

      <section class="products-column">
        <div class="products-header">
          <p class="results-count">
            @if (filteredProducts().length === 0) {
              {{ translate('storePage.products.none') }}
            } @else {
              {{ translate('storePage.products.found', {count: filteredProducts().length}) }}
            }
          </p>
        </div>

        @if (filteredProducts().length > 0) {
          <div class="products-grid">
            @for (product of filteredProducts(); track product.id; let i = $index) {
              <a [routerLink]="['/products', product.id]" class="product-card">
                <div class="product-image">
                  <img
                    [src]="product.images[0]"
                    [alt]="product.name"
                    [loading]="i < 4 ? 'eager' : 'lazy'"
                    [attr.fetchpriority]="i < 2 ? 'high' : 'auto'"
                  />
                </div>
                <div class="product-info">
                  <div class="product-header-row">
                    <p class="product-brand">{{ product.brand }}</p>
                    @if (product.brand && store()) {
                      <img
                        class="product-store-logo"
                        [src]="store()!.logoImageUrl"
                        [alt]="store()!.name + ' logo'"
                      />
                    }
                  </div>
                  <h3 class="product-name">{{ product.name }}</h3>
                  <p class="product-price">{{ product.price }} {{ translate('common.egp') }}</p>
                  <div class="modesty-badges">
                    @if (product.modestyAttributes.includes('opaque')) {
                      <span class="badge">Opaque</span>
                    }
                    @if (product.modestyAttributes.includes('maxi_length')) {
                      <span class="badge">Maxi Length</span>
                    }
                    @if (product.modestyAttributes.includes('loose_fit')) {
                      <span class="badge">Loose Fit</span>
                    }
                  </div>
                </div>
              </a>
            }
          </div>
        } @else {
          <div class="empty-state">
            <p>{{ translate('storePage.products.none') }}</p>
            <button type="button" class="clear-filters-btn" (click)="onFiltersChange({})">
              {{ translate('common.clear') }}
            </button>
          </div>
        }
      </section>
    </div>
  </div>
} @else {
  <div class="loading">{{ translate('storePage.loading') }}</div>
}

